<!-- =========================================================================
     Path: frontend/src/app/features/sequence-box/sequence-box.component.html
     Version: v2.8.0
     ========================================================================= -->
<div class="card">
  <div class="card-header">
    <div class="title">Sequence</div>
    <div class="meta">
      <span>Length: {{ a.length() }} bp</span>
      <span *ngIf="hasInvalid()"> • non-DNA chars: {{ invalidCount() }}</span>
      <span *ngIf="a.selectedKind()"> • selected: {{ a.selectedKind() }} ({{ selRanges().length }} merged)</span>
      <span> • cursor: {{ cursorPos() + 1 }}</span>
      <span *ngIf="lastFastaName()"> • FASTA: {{ lastFastaName() }}<ng-container *ngIf="lastFastaId()">( {{ lastFastaId() }} )</ng-container></span>
    </div>
  </div>

  <div class="controls">
    <label class="hide-all">
      <input type="checkbox" [checked]="hideAllWhenSelected()" (change)="onHideAllToggle($event)">
      Hide “All ranges” bar when a single range is selected
    </label>

    <div class="right-controls">
      <label class="upload">
        <input type="file" accept=".fa,.fasta,.txt" (change)="onFastaFile($event)">
        Upload FASTA
      </label>
      <span class="cols">Per-line: {{ lineWidth() }} nt</span>
    </div>
  </div>

  <div #viz class="viz" tabindex="0"
       (click)="focusViz()"
       (keydown)="onVizKeydown($event)"
       (paste)="onVizPaste($event)"
       (copy)="onVizCopy($event)">
    <ng-container *ngIf="a.sequence(); else empty">
      <div class="line" *ngFor="let ln of lines()">
        <!-- Bases (selection handled here) -->
        <div class="grid mono"
             [style.gridTemplateColumns]="'repeat(' + ln.cells.length + ', 1ch)'">
          <span *ngFor="let c of ln.cells"
                [class]="c.cls"
                [class.sel]="isSelected(c.abs)"
                (mousedown)="onCellMouseDown(c.abs, $event.shiftKey)"
                (mouseenter)="onCellMouseEnter(c.abs)"
                (click)="onCellClick(c.abs)">
            {{ c.ch }}
          </span>
        </div>

        <!-- CARET overlay (absolute, sits over the base row) -->
        <div class="caret grid mono"
             [style.gridTemplateColumns]="'repeat(' + ln.caret.length + ', 1ch)'">
          <span *ngFor="let on of ln.caret" class="caretcell" [class.on]="on"></span>
        </div>

        <!-- Short ticks -->
        <div class="grid mono tick"
             [style.gridTemplateColumns]="'repeat(' + ln.tick.length + ', 1ch)'">
          <span *ngFor="let on of ln.tick" class="tickcell" [class.on]="on"></span>
        </div>

        <!-- Numeric ruler -->
        <div class="grid mono ruler"
             [style.gridTemplateColumns]="'repeat(' + ln.ruler.length + ', 1ch)'">
          <span *ngFor="let r of ln.ruler" class="r"> {{ r }} </span>
        </div>

        <!-- All ranges -->
        <div class="grid bars"
             *ngIf="!(hideAllWhenSelected() && selRange())"
             [style.gridTemplateColumns]="'repeat(' + ln.barAll.length + ', 1ch)'">
          <span *ngFor="let on of ln.barAll" class="barcell"
                [style.background]="on ? barColorAll() : 'transparent'"></span>
        </div>

        <!-- Selected range -->
        <div class="grid bars sel"
             [style.gridTemplateColumns]="'repeat(' + ln.barSel.length + ', 1ch)'">
          <span *ngFor="let on of ln.barSel" class="barcell"
                [style.background]="on ? barColorSel() : 'transparent'"></span>
        </div>
      </div>
    </ng-container>
    <ng-template #empty>
      <div class="placeholder">Click here and type/paste DNA (A C G T)… or upload FASTA above.</div>
    </ng-template>
  </div>
</div>
